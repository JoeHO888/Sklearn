from flask import Flask
import requests
from flask import request
import numpy as np
from time import sleep
from sklearn.linear_model import LinearRegression
from sklearn.preprocessing import LabelEncoder


app = Flask(__name__)

Data = [ [] for i in range(5)]
lr = LinearRegression()
le = LabelEncoder()

@app.route('/learn',methods=['GET', 'POST'])
def learn():
  raw_data = request.get_json()
  Data[0].append(raw_data["A"])
  Data[1].append(raw_data["B"])
  Data[2].append(raw_data["C"])
  Data[3].append(raw_data["D"])
  Data[4].append(raw_data["E"])
  return "Input is stored"

sleep(1)

@app.route('/train',methods=['GET', 'POST'])
def train():
  le.fit(Data[0])
  category1 = le.transform(Data[0])
  le.fit(Data[1])
  category2 = le.transform(Data[1])
  X = np.concatenate((category1[:,np.newaxis],category2[:,np.newaxis],np.array(Data[2:4]).T),axis=1)
  y = np.array(Data[4])
  lr.fit(X,y)
  return "Model Trained"

@app.route('/predict',methods=['GET', 'POST'])
def predict():
  predict = request.get_json()
  return "Predicted value: " + str(lr.predict(np.array([predict[e] for e in predict])))
	
